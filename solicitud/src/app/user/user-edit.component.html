<p-toast></p-toast>
<form novalidate [formGroup]="usuarioForm">
    <div class="card mb-5 mx-5 shadow-lg">
        <div class="card-header text-white">
            <p class="font-weight-bold text-center" [style.font-size.px]="20">Registro de usuarios</p>
        </div>
        <div class="card-body px-5 py-5">

            <div class="p-fluid p-formgrid p-grid">
                <div class="p-field p-col-12 p-md-6">
                    <label for="nombreUsuario"><strong>Nombre:<strong class="text-danger">*</strong></strong></label>
                    <input id="nombreUsuario" pInputText type="text" formControlName="name" class="form-control"
                        [ngClass]="{'is-invalid ng-dirty': 
                                        (usuarioForm.get('name').touched ||
                                        usuarioForm.get('name').dirty) && 
                                        !usuarioForm.get('name').valid}">
                    <span class="invalid-feedback">
                        <span *ngIf="usuarioForm.get('name').errors?.required">
                            Por favor ingrese un nombre.
                        </span>
                    </span>

                </div>



                <div class="p-field p-col-12 p-md-6">
                    <label for="cargoUsuario"><strong>Cargo:<strong class="text-danger">*</strong></strong></label>
                    <input id="cargoUsuario" pInputText type="text" formControlName="position" class="form-control"
                        [ngClass]="{'is-invalid ng-dirty': 
                                                                (usuarioForm.get('position').touched ||
                                                                usuarioForm.get('position').dirty) && 
                                                                !usuarioForm.get('position').valid}">
                    <span class="invalid-feedback">
                        <span *ngIf="usuarioForm.get('position').errors?.required">
                            Por favor ingrese el cargo del usuario.
                        </span>
                    </span>
                </div>

                <div class="p-field p-col-12 p-md-6">

                    <label for="emailUsuario"><strong>Email:<strong class="text-danger">*</strong></strong></label>
                    <input id="emailUsuario" pInputText type="text" formControlName="email" class="form-control"
                        [ngClass]="{'is-invalid ng-dirty': 
                                                (usuarioForm.get('email').touched ||
                                                usuarioForm.get('email').dirty) && 
                                                !usuarioForm.get('email').valid}">
                    <span class="invalid-feedback">
                        <span *ngIf="usuarioForm.get('email').errors?.required">
                            Por favor ingrese email.
                        </span>
                    </span>

                </div>
                <div class="p-field p-col-12 p-md-6">

                    <label for="passwordUsuario"><strong>Password:<strong
                                class="text-danger">*</strong></strong></label>
                    <p-password inputId="passwordUsuario" formControlName="password"
                        [ngClass]="{'is-invalid ng-dirty': 
                                                        (usuarioForm.get('password').touched ||
                                                        usuarioForm.get('password').dirty) && 
                                                        !usuarioForm.get('password').valid}">
                                                        </p-password>
                </div>


                <div class="p-field p-col-12">
                    <div>
                        <label for="nombre" class="col-form-label"><b>Roles</b></label>
                    </div>
                </div>
                <div class="p-field p-col-12">


                    <div formArrayName="roles" *ngFor="let especifica of roles.controls; let i=index">
                        <div class="mb-3">
                            <div class="p-grid p-jc-center form-group row">
                                <div class="p-col-4">
                                    <div class="box">
                                        <p-dropdown [options]="rolOptions" [formControlName]="i"
                                            placeholder="Seleccione tipo" inputId="tipo">
                                        </p-dropdown>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-field p-col-12">
                    <label for="files" class="col-form-label"><b>Firma digital:</b></label>
                    <p-fileUpload name="files" chooseLabel="Elegir" [showUploadButton]="false"
                        (onSelect)="onFileSelected($event)"></p-fileUpload>
                </div>
                <div class="p-field p-col-12">
                    <div *ngIf="user">
                        <button class="btn btn-outline-primary btn-sm" (click)="toggleImage()">
                            {{loadImage ? "Ocultar" : "Mostrar"}} Firma
                        </button>
                        <div *ngIf="loadImage" class="p-col-6 p-offset-3">
                            <img [src]="url" [style.height.px]="250" [style.margin.px]="2" alt="firma"
                                *ngIf="loadImage && url">
                        </div>
                    </div>
                </div>
            </div>

            <div class="alert alert-danger mt-3" *ngIf="submitted">{{mensajeError}}</div>

        </div>
    </div>
</form>



<div class="form-group row">
    <div class="offset-md-1 mb-5">
        <button class="btn btn-success mr-3" style="width:200px;" type="submit" (click)="saveUser()"
            [title]="usuarioForm.valid ? 'Save your entered data' : 'Disabled until the form data is valid'"
            [disabled]="!usuarioForm.valid">
            Enviar
        </button>
        <button class="btn btn-outline-secondary mr-3" style="width:100px;" type="button" title="Cancelar"
            routerLink="/usuario">
            Cancelar
        </button>
        <button class="btn btn-outline-warning" style="width:90px" type="button" title="Borrar solicitud"
            (click)="deleteUser()">
            Borrar
        </button>
    </div>
</div>
<p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>