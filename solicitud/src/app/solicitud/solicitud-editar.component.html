<div class="container">
  <div class="p-grid">
    <div class="p-col-12 p-md-4 p-lg-4">
      <img class="center-block img-responsive" src="../../assets/siu-02.png" [style.height.px]="120"
        [style.margin.px]="2" width="100%" alt="Logo imagen">
    </div>
    <div class="p-col-12 p-md-8 p-lg-8">

      <h4 class="card-title text-center">SOLICITUD DE TRÁMITE PARA COMPRAS INFERIORES A 30 SMMLV</h4>
      <p class="text-center card-text">COORDINACIÓN DE PROCESO ADMINISTRACIÓN DE PROYECTOS</p>
      <p class="text-center card-text">Administración de Proyectos de Investigación y Extensión</p>
      <p class="text-center card-text">Administración SIU</p>
    </div>
  </div>

  <form novalidate [formGroup]="solicitudForm" (ngSubmit)="saveSolicitud()">

    <div class="card mb-5 mx-5 shadow-lg">
      <div class="card-header text-white">
        <p class="font-weight-bold text-center" [style.font-size.px]="20">INFORMACIÓN DE SOLICITANTES</p>
      </div>
      <div class="card-body px-5 py-5">
        <div class="p-fluid p-formgrid p-grid">
          <div class="p-field p-col-12 p-md-6 p-lg-4">
              <label for="tipoTramite"><strong>Tipo de tramite:</strong></label>            
              <p-dropdown [options]="tipoTramites"
                                  placeholder="Seleccione tipo de tramite" 
                                  formControlName="tipoTramite"
                                  id="tipoTramite"                                 
                                  ></p-dropdown>
              <span class="invalid-feedback">
                <span>
                    Por favor seleccione un tipo de trámite.
                </span>
              </span> 
            
          </div>
          <div class="p-field p-col-12 p-md-6 p-lg-4">
              <label for="grupoInvestigacion"><strong>Grupo de investigacion:</strong></label>            
              <p-dropdown [options]="grupos"
                                  placeholder="Seleccione grupo"                                   
                                  formControlName="grupo" optionLabel="nombre"
                                  dataKey="grupo"
                                  inputId="grupoInvestigacion"
                                  (onChange)="displayProyectos()">
                                  </p-dropdown>
              <span class="invalid-feedback">
                <span>
                    Por favor seleccione el grupo de investigacion.
                </span>
              </span> 
            
          </div>
          <div class="p-field p-col-12 p-md-12 p-lg-4">
        
              <label for="nombreContacto"><strong>Nombre Contacto grupo:</strong></label>            
              <input id="nombreContacto" pInputText
                type="text" formControlName="nombreContacto">
              <span class="invalid-feedback">
              <span>
                  Por favor ingrese un nombre de contacto.
              </span>
              </span> 

          </div>
          <div class="p-field p-col-12 p-md-6 p-lg-3">
              <label for="investigador"><strong>Investigador:</strong></label>            
              <p-dropdown [options]="investigadores"
                                  placeholder="Seleccione Investigador" optionLabel="nombre"     
                                  formControlName="investigador"
                                  id="investigador" dataKey="investigador"
                                  (onChange)="displayInvestigador($event.value)"></p-dropdown>
              <span class="invalid-feedback">
              <span>
                  Por favor seleccione el investigador.
              </span>
              </span> 

          </div>
          <div class="p-field p-col-12 p-md-6 p-lg-3">
              <label for="identificacionInvestigador"><strong>Identificacion:</strong></label>            
              <input id="identificacionInvestigador" pInputText
                type="text" formControlName="_identificacion_investigador">
          </div>
          <div class="p-field p-col-12 p-md-6 p-lg-3">
 
              <label for="telefonoContacto"><strong>Telefono contacto:</strong></label>            
              <input id="telefonoContacto" pInputText
                type="text" formControlName="telefonoContacto">
              <span class="invalid-feedback">
              <span>
                  Por favor ingrese un telefono de contacto.
              </span>
              </span> 

          </div>
          <div class="p-field p-col-12 p-md-6 p-lg-3">
              <label for="cargo"><strong>Cargo:</strong></label>            
              <input id="cargo" pInputText
                type="text" formControlName="cargo">
              <span class="invalid-feedback">
              <span>
                  Por favor ingrese la necesidad.
              </span>
              </span> 

          </div>
      </div>
      </div>
    </div>
    <div class="card mb-5 mx-5 shadow-lg">
      <div class="card-header text-white">
        <p class="font-weight-bold text-center" [style.font-size.px]="20">INFORMACIÓN DEL PROYECTO ASOCIADO CON EL TRÁMITE</p>
      </div>
      <div class="card-body px-5 py-5">
        <div class="p-fluid p-formgrid p-grid">
          <div class="p-field p-col-12">
            <p>{{parametroNecesidad.descripcion}} </p>
  
          </div>
          <div class="p-field p-col-12 p-md-6 p-lg-12">
              <label for="proyecto"><strong>Nombre del proyecto:</strong></label>            
              <p-dropdown [options]="solicitudForm.get('grupo').value.proyectos"
                                  placeholder="Seleccione proyecto"                                                                    
                                  inputId="proyecto" dataKey="proyecto"                          
                                  formControlName="proyecto" optionLabel="nombre"
                                  (onChange)="displayProyecto($event.value)">
                                  </p-dropdown>
              <span class="invalid-feedback">
                <span>
                    Por favor seleccione un proyecto.
                </span>
              </span> 
            
          </div>
          <div class="p-field p-col-12 p-md-6 p-lg-4">
              <label for="codigo"><strong>Codigo del proyecto:</strong></label>            
              <input id="codigo" pInputText
                type="text" formControlName="_codigo_proyecto">                           
          </div>
          <div class="p-field p-col-12 p-md-6 p-lg-4">
        
              <label for="costos"><strong>Centro de costos:</strong></label>            
              <input id="costos" pInputText formControlName="_centro_costos_proyecto"
                type="text" >    
          </div>
          <div class="p-field p-col-12 p-md-6 p-lg-4">
 
              <label for="fecha"><strong>Fecha:</strong></label>            
              <p-calendar formControlName="fecha"
                          dateFormat="dd-mm-yy" inputId="fecha"></p-calendar>
              <span class="invalid-feedback">
                <span>
                    Por favor la fecha.
                </span>
              </span> 

          </div>          
      </div>
      </div>
    </div>
    <div class="card mb-5 mx-5 shadow-lg">
      <div class="card-header text-white">
        <p class="font-weight-bold text-center" [style.font-size.px]="20">DETALLE DEL TRÁMITE</p>
      </div>
      <div class="card-body px-5 py-5">      
        <div class="p-fluid p-formgrid p-grid">
          <p-table [value]="detalleTramiteDtos.controls" styleClass="p-datatable-responsive-demo" class="p-field">
            <ng-template pTemplate="header">
                <tr>
                    <th>Linea General</th>
                    <th>Linea Especifica</th>
                    <th>Descripcion</th>
                    <th>Cantidad</th>
                    <th>Action</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" formArrayName="detalleTramiteDtos" let-detail let-rowIndex="rowIndex">
                <tr [formGroupName]="rowIndex">
                  <td>
                    <span class="p-column-title">Linea General</span>
                    <p-dropdown [options]="lineasGenerales"  
                                optionLabel="nombre"
                                placeholder="Seleccione linea"
                                [dataKey]="rowIndex + 'lineaGeneral'"                            
                                formControlName="lineaGeneral"
                                (onChange)="displayLineasEspecificas(detail)"                                                                                                                          
                                ></p-dropdown>
                  </td>
                  <td >
                  <span class="p-column-title">Linea Especfica</span>
                  <p-dropdown [options]="detail.get('lineaGeneral').value.lineaEspecificas"  
                                optionLabel="nombre"                                                          
                                placeholder="Seleccione linea"                                                  
                                formControlName="lineaEspecifica"                                                                                           
                                ></p-dropdown>
                  </td>
                  <td >
                <span class="p-column-title">Descripcion</span>
                <textarea pInputTextarea type="text" formControlName="descripcion"></textarea>
                  </td>
                  <td>
              <span class="p-column-title">Cantidad</span>
              <input pInputText type="text" formControlName="cantidad">
                  </td>
                  <td >
                        
                      <button type="button" pButton pRipple class="p-button-warning p-mr-2" *ngIf="rowIndex >= 1"
                              icon="pi pi-trash"
                              (click)="deleteDetails(rowIndex)"></button>
                  </td>
                </tr>
            </ng-template>
          </p-table>
          <div class="p-field p-col-6 p-offset-3 ">
            <button pButton type="button" label="Agregar" 
                    class="p-button-outlined p-button-success"
                    (click)="addDetails()"></button>
          </div>
          <div class="p-field p-col-12">
              <label for="valor"><strong>VALOR O PRESUPUESTO ESTIMADO:</strong></label>            
              <p-inputNumber formControlName="valor" 
                              inputId="valor" mode="currency" 
                              currency="COP" locale="es-CO">
              </p-inputNumber>
              <span class="invalid-feedback">
                <span>
                    Por favor ingrese un valor.
                </span>
              </span> 
          </div>
          <div class="p-field p-col-12">
              <label><strong>VERIFICACIÓN DE CONTRATOS MARCO O ACUERDOS GENERALES PARA EL SERVICIO, OBRA O BIEN REQUERIDO (Marque con una X la opción):</strong></label>            
              <div class="p-formgroup-inline">
                <div class="p-field-radiobutton">                  
                  <p-radioButton value="si" formControlName="verificacion" inputId="si"></p-radioButton>
                  <label for="si">Si existe</label>
                </div>
                <div class="p-field-radiobutton">                  
                  <p-radioButton value="no" formControlName="verificacion" inputId="no"></p-radioButton>
                  <label for="no">No existe</label>
                </div>
              </div>
              <span class="invalid-feedback">
                <span>
                    Por favor verifique campos.
                </span>
              </span> 
          </div>                    
        </div>
      </div>
    </div>


    <div class="card mb-5 mx-5 shadow-lg">
      <div class="card-header text-white">
        <p class="font-weight-bold text-center" [style.font-size.px]="20">Precotizaciones</p>
      </div>
      <div class="card-body px-5 py-5">
        <div class="p-fluid p-formgrid p-grid">
          <div class="p-field p-col-12">
            <strong>IMPORTANTE: Si tiene precotizaciones previas, por favor adjuntelas al ticket y diligencie el siguiente cuadro: </strong>
          </div>
          <p-table [value]="precotizacionDtos.controls" styleClass="p-datatable-responsive-demo" class="p-field">
            <ng-template pTemplate="header">
                <tr>
                    <th>Nombre del proveedor</th>
                    <th>Nit/Cédula</th>
                    <th>Teléfono</th>
                    <th>Ciudad</th>
                    <th>Valor total Precotizado</th>
                    <th>Valor total del IVA</th>
                    <th>Action</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" formArrayName="precotizacionDtos" let-precotizacion let-rowIndex="rowIndex">
                <tr [formGroupName]="rowIndex">                               
                    <td>                    
                      <span class="p-column-title">Proveedor</span>                        
                      <p-dropdown [options]="proveedores"
                      placeholder="Seleccione proveedor" optionLabel="nombre"
                      (onChange)="displayProveedor(precotizacion)"
                      formControlName="proveedor"></p-dropdown>                           
                    </td>
                    <td>
                      <span class="p-column-title">Nit/Cédula</span>
                      <input pInputText type="text" 
                      formControlName="_identificacion_proveedor">
                    </td>
                    <td>
                      <span class="p-column-title">Telefono</span>
                      <input pInputText type="text"
                      formControlName="_telefono_proveedor">
                    </td>
                    <td>
                      <span class="p-column-title">Ciudad</span>
                      <input pInputText type="text"
                      formControlName="_ciudad_proveedor">                    
                    </td>                  
                    <td>
                      <span class="p-column-title">Valor total</span>
                      <p-inputNumber inputId="valor_selected" mode="currency" 
                            currency="COP" locale="es-CO" formControlName="valorTotal">
                  </p-inputNumber> 
                    </td>
                    <td>
                      <span class="p-column-title">Valor total del IVA</span>
                      <p-inputNumber inputId="valor_selected" mode="currency" 
                      currency="COP" locale="es-CO" formControlName="valorIva">
            </p-inputNumber>                     
                  </td>
                  <td >                      
                    <button type="button" pButton pRipple class="p-button-warning p-mr-2" 
                            icon="pi pi-trash"
                            (click)="deletePrecotizacion(rowIndex)"></button>
                  </td>
                </tr>
            </ng-template>
          </p-table>
          <div class="p-field p-col-6 p-offset-3">
            <button pButton type="button" label="Agregar Precotizacion" class="p-button-outlined p-button-success"
            (click)="addPrecotizacion()"></button>
          </div>          
          <div class="p-field p-col-12 text-danger">
            <p>NOTA: Recuerde que la cotización a elegir será la más económica partiendo del principio de economía.
              En caso de seleccionar un proveedor por un concepto diferente, deberá justificar el por qué en el campo Observaciones..</p>
          </div>
          <div class="p-field p-col-12">
            <label for="nombre"><strong>De acuerdo con las cotizaciones recibidas, se decide contratar con :</strong></label>            
            <p-dropdown [options]="precotizacionDtos.controls"
                        placeholder="Seleccione proveedor" optionLabel="value.proveedor.nombre" dataKey="precotizacionElegida"                           
                        optionValue="value" formControlName="precotizacionDto" (onChange)="displayValorSelected()"
                        ></p-dropdown>
            <span class="invalid-feedback">
            <span>
                Por favor ingrese la necesidad.
            </span>
            </span> 

          </div>
          <div class="p-field p-col-12">
              <label for="valor_selected"><strong>por valor de:</strong></label>            
              <p-inputNumber inputId="valor_selected" mode="currency" 
                            currency="COP" locale="es-CO" formControlName="_valor_selected">
                  </p-inputNumber> 
              <span class="invalid-feedback">
              <span>
                  Por favor ingrese la necesidad.
              </span>
              </span> 
          </div>
          <p-table [value]="argumentoDtos.controls" styleClass="p-datatable-responsive-demo" class="p-field">
        <ng-template pTemplate="header">
            <tr>
                <th>Argumentos de la contratacion</th>
                <th>Action</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-argumento let-rowIndex="rowIndex" formArrayName="argumentoDtos">
            <tr [formGroupName]="rowIndex">
              <td>
                <span class="p-column-title">Descripcion</span>
                <p-dropdown [options]="argumentos"
                            placeholder="Seleccione argumento" optionLabel="descripcion"
                            optionValue="descripcion"
                            formControlName="descripcion"                                
                            editable="true"></p-dropdown>                
              </td>
              <td >                  
                <button type="button" pButton pRipple 
                        class="p-button-warning p-mr-2" 
                        icon="pi pi-trash"
                        (click)="deleteArgumento(rowIndex)"></button>
              </td>
            </tr>            
        </ng-template>
          </p-table>

          <div class="p-field p-col-6 p-offset-3">
            <button pButton type="button" 
                    label="Agregar otro argumento" 
                    class="p-button-outlined p-button-success"
                    (click)="addArgumento()"></button>
          </div>

          <div class="p-field p-col-12 ">
            <label for="nombre"><strong>Observaciones:</strong></label>            
            <textarea id="nombre" pInputTextarea formControlName="observacion"
              type="text" rows="5"></textarea>
            <span class="invalid-feedback">
            <span>
                Por favor ingrese la necesidad.
            </span>
            </span> 

          </div>

          <div class="p-field p-col-12">
            <label for="nombre"><strong>Tener en cuenta:</strong></label>      
            <p id="nombre">Esta información la utilizará la "Administración SIU" para diligenciar los formatos de "Estudio de Necesidad y 
              Conveniencia para Cuantías Menores o Iguales a 30 SMMLV" y "Consulta de Precios del Mercado" en cumplimiento del 
              Estatuto Contractual, formatos que estaban inicialmente bajo el diligenciamiento de los grupos de investigacion. 
              Por lo tanto, la información que se digite en el presente formato de SOLICITUD DE TRAMITE es la misma que se 
              utilizará para diligenciar los formatos correspondientes. En este sentido, cualquier error o inconsistencia será 
              responsabilidad de quien diligencie la información y no de la Administración SIU.</p>
          </div>



        </div>
      </div>
    </div>







    <div class="form-group row">
      <div class="offset-md-1 mb-5">
        <button class="btn btn-success mr-3" style="width:200px;" type="submit"
          [title]="solicitudForm.valid ? 'Save your entered data' : 'Disabled until the form data is valid'"
          [disabled]="!solicitudForm.valid">
          Enviar
        </button>
        <button class="btn btn-outline-secondary mr-3" style="width:100px;" type="button" title="Cancelar"
          [routerLink]="['/solicitud']">
          Cancelar
        </button>
        <button class="btn btn-outline-warning" *ngIf="!agregarSolicitud" style="width:90px" type="button"
          title="Borrar solicitud" (click)="deleteSolicitud()">
          Borrar
        </button>
      </div>
    </div>

  </form>
  <h4>Solicitud Formulario</h4>
  <pre>

    {{solicitudForm.value | json}}
  </pre>
  <br>
</div>