
<form [formGroup]="solicitudForm">
<div class="card mb-5 mx-5 shadow-lg">
    <div class="card-header text-white">
      <p class="font-weight-bold text-center" [style.font-size.px]="20">DETALLE DEL TRÁMITE</p>
    </div>
    <div class="card-body px-5 py-5">      
      <div class="p-fluid p-formgrid p-grid">
        <p-table [value]="detalleTramiteDtos.controls" styleClass="p-datatable-responsive-demo" class="p-field">
          <ng-template pTemplate="header">
              <tr>
                  <th>Linea General</th>
                  <th>Linea Especifica</th>
                  <th>Descripcion</th>
                  <th>Cantidad</th>
                  <th>Eliminar</th>
              </tr>
          </ng-template>
          <ng-template pTemplate="body" formArrayName="detalleTramiteDtos" let-detail let-rowIndex="rowIndex">
              <tr [formGroupName]="rowIndex">
                <td>
                  <span class="p-column-title">Linea General<strong class="text-danger">*</strong></span>
                  <p-dropdown [options]="lineasGenerales"  
                              optionLabel="nombre"
                              placeholder="Seleccione linea"
                              dataKey="id"
                              formControlName="lineaGeneral"
                              [ngClass]="{'is-invalid ng-dirty': 
                                  (detail.get('lineaGeneral').touched || 
                                  detail.get('lineaGeneral').dirty) && 
                                  !detail.get('lineaGeneral').valid}"
                              (onChange)="displayLineasEspecificas(detail)"                                                                                                                          
                              ></p-dropdown>
                </td>
                <td >
                <span class="p-column-title">Linea Especfica<strong class="text-danger">*</strong></span>
                <p-dropdown [options]="detail.get('lineaGeneral').value.lineaEspecificas"  
                              optionLabel="nombre"                                                          
                              placeholder="Seleccione linea"                                                  
                              formControlName="lineaEspecifica"
                              [ngClass]="{'is-invalid ng-dirty': 
                                  (detail.get('lineaEspecifica').touched || 
                                  detail.get('lineaEspecifica').dirty) && 
                                  !detail.get('lineaEspecifica').valid}"
                              (onChange)="displayLineasEspecificas(detail)"                                                                                          
                              ></p-dropdown>
                </td>
                <td >
              <span class="p-column-title">Descripcion<strong class="text-danger">*</strong></span>
              <textarea pInputTextarea type="text" rows="5" formControlName="descripcion"
                        [ngClass]="{'is-invalid ng-dirty': 
                        (detail.get('descripcion').touched || 
                        detail.get('descripcion').dirty) && 
                        !detail.get('descripcion').valid}"></textarea>
                </td>
                <td>
            <span class="p-column-title">Cantidad<strong class="text-danger">*</strong></span>
            <input pInputText type="text" formControlName="cantidad"
                    [ngClass]="{'is-invalid ng-dirty': 
                                (detail.get('cantidad').touched || 
                                detail.get('cantidad').dirty) && 
                                !detail.get('cantidad').valid}">
                </td>
                <td >
                      
                    <button type="button" pButton pRipple class="p-button-warning p-mr-2" *ngIf="rowIndex >= 1"
                            icon="pi pi-trash"
                            (click)="deleteDetails(rowIndex)"></button>
                </td>
              </tr>
          </ng-template>
        </p-table>
        <div class="p-field p-col-6 p-offset-3 ">
          <button pButton type="button" label="Agregar" 
                  class="p-button-outlined p-button-success"
                  (click)="addDetails()"></button>
        </div>
        <div class="p-field p-col-12">
            <label for="valor"><strong>VALOR O PRESUPUESTO ESTIMADO:<strong class="text-danger">*</strong></strong></label>            
            <p-inputNumber formControlName="valor" 
                            inputId="valor" mode="currency" 
                            currency="COP" locale="es-CO"
                            [ngClass]="{'is-invalid ng-dirty': 
                                (solicitudForm.get('valor').touched || 
                                solicitudForm.get('valor').dirty) && 
                                !solicitudForm.get('valor').valid}">
            </p-inputNumber>
            <span class="invalid-feedback">
              <span *ngIf="solicitudForm.get('valor').errors?.required">
                  Por favor ingrese un valor.
              </span>
            </span> 
        </div>
        <div class="p-field p-col-12">
            <label><strong>VERIFICACIÓN DE CONTRATOS MARCO O ACUERDOS GENERALES PARA EL SERVICIO, OBRA O BIEN REQUERIDO:<strong class="text-danger">*</strong></strong></label>            
            <div class="p-formgroup-inline">
              <div class="p-field-radiobutton">                  
                <p-radioButton value="si" formControlName="verificacion" inputId="si"></p-radioButton>
                <label for="si">Si existe</label>
              </div>
              <div class="p-field-radiobutton">                  
                <p-radioButton value="no" formControlName="verificacion" inputId="no"></p-radioButton>
                <label for="no">No existe</label>
              </div>
            </div>
            <span class="invalid-feedback">
              <span>
                  Por favor verifique campos.
              </span>
            </span> 
        </div>                    
      </div>
      <div class="p-grid p-nogutter p-justify-between">
        <p-button label="Atras" [routerLink]="['../proyecto']" icon="pi pi-angle-left"></p-button>
        <p-button label="Siguiente" [routerLink]="['../precotizacion']" icon="pi pi-angle-right" iconPos="right"></p-button>
    </div>
    </div>
  </div>
</form>